<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goida VPN Configs</title>
    <link rel="icon" type="image/png" href="static/images/favicon.png">
    <link rel="apple-touch-icon" href="static/images/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script defer src="static/js/update-download-links.js"></script>
    <script defer src="static/js/statistics.js"></script>

    <script>
        // Применить тему ДО отрисовки страницы чтобы избежать мигания
        (function() {
            const darkMode = localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            if (darkMode) {
                document.documentElement.classList.add('dark');
            }
        })();
        
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            blue: '#3670A0',
                            yellow: '#ffdd54',
                            dark: '#0f172a',
                            panel: '#1e293b'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }

        /* Базовые настройки для обоих пятен света */
        body::before, body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
            filter: blur(100px); /* Сильное размытие для мягкости */
            opacity: 0.6;
            will-change: transform; /* Оптимизация производительности */
        }

        /* --- СИНЕЕ ПЯТНО (Goida Blue) --- */
        body::before {
            width: 70vw;
            height: 70vw;
            background: radial-gradient(circle, rgba(54, 112, 160, 0.4) 0%, rgba(54, 112, 160, 0) 70%);
            top: -20%;
            left: -20%;
            animation: driftBlue 25s infinite alternate ease-in-out;
        }

        /* --- ЖЕЛТОЕ ПЯТНО (Goida Yellow) --- */
        body::after {
            width: 60vw;
            height: 60vw;
            background: radial-gradient(circle, rgba(255, 221, 84, 0.25) 0%, rgba(255, 221, 84, 0) 70%);
            bottom: -20%;
            right: -20%;
            animation: driftYellow 30s infinite alternate-reverse ease-in-out;
        }

        /* --- НАСТРОЙКИ ДЛЯ ТЕМНОЙ ТЕМЫ --- */
        /* В темной теме делаем цвета чуть менее прозрачными, чтобы они светились на черном фоне */
        body.dark::before {
            opacity: 0.5;
            background: radial-gradient(circle, rgba(54, 112, 160, 0.5) 0%, rgba(54, 112, 160, 0) 70%);
        }

        body.dark::after {
            opacity: 0.3;
            background: radial-gradient(circle, rgba(255, 221, 84, 0.3) 0%, rgba(255, 221, 84, 0) 70%);
        }

        /* --- АНИМАЦИИ --- */
        
        /* Движение синего пятна: Слева-Сверху -> Вниз -> Вправо */
        @keyframes driftBlue {
            0% {
                transform: translate(0, 0) scale(1);
            }
            33% {
                transform: translate(40vw, 20vh) scale(1.2);
            }
            66% {
                transform: translate(10vw, 50vh) scale(0.9);
            }
            100% {
                transform: translate(0, 30vh) scale(1.1);
            }
        }

        /* Движение желтого пятна: Справа-Снизу -> Вверх -> Влево */
        @keyframes driftYellow {
            0% {
                transform: translate(0, 0) scale(1);
            }
            33% {
                transform: translate(-30vw, -20vh) scale(1.3);
            }
            66% {
                transform: translate(-50vw, 10vh) scale(0.8);
            }
            100% {
                transform: translate(-20vw, -40vh) scale(1.1);
            }
        }

        main {
            position: relative;
            z-index: 0;
        }
        .body--lock {
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-brand-dark dark:text-gray-100 transition-colors duration-300 font-sans"
      x-data="{ 
          darkMode: localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches),
          toggleTheme() {
              this.darkMode = !this.darkMode;
              localStorage.setItem('theme', this.darkMode ? 'dark' : 'light');
              if (this.darkMode) document.documentElement.classList.add('dark');
              else document.documentElement.classList.remove('dark');
          },
          activeTab: 'configs',
          showSourcesModal: false,
          showStatsModal: false,
          currentSources: [],
          currentConfigId: null
      }"
      x-init="$watch('darkMode', val => val ? document.documentElement.classList.add('dark') : document.documentElement.classList.remove('dark')); if(darkMode) document.documentElement.classList.add('dark'); $watch('showStatsModal', value => { if (value) { document.body.classList.add('body--lock'); loadGitHubStats(); } else { document.body.classList.remove('body--lock'); } });"
>

    {% include 'components/header.html' %}

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% block content %}{% endblock %}
    </main>

    <!-- Модальное окно статистики -->
    <div x-show="showStatsModal"
         @keydown.escape="showStatsModal = false"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
         @click.self="showStatsModal = false">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="bg-white dark:bg-brand-panel rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] flex flex-col">

            <div class="border-b border-gray-200 dark:border-gray-700 p-6 flex items-center justify-between flex-shrink-0">
                <h3 class="text-lg font-bold flex items-center gap-2">
                    <i class="fa-solid fa-chart-simple text-blue-500"></i>
                    <span>Статистика репозитория</span>
                </h3>
                <button @click="showStatsModal = false"
                        class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <div class="p-6 overflow-y-auto" id="stats-content">
                <!-- Сюда будет загружаться статистика -->
                <div class="text-center">
                    <i class="fa-solid fa-spinner fa-spin text-3xl text-gray-400"></i>
                    <p class="mt-2 text-sm text-gray-500">Загрузка данных...</p>
                </div>
            </div>

            <div class="border-t border-gray-200 dark:border-gray-700 p-4 flex-shrink-0">
                <button @click="showStatsModal = false"
                        class="w-full py-2 rounded font-semibold bg-red-600 hover:bg-red-700 text-white transition">
                    Закрыть
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно с источниками -->
    <div x-show="showSourcesModal" 
         @keydown.escape="showSourcesModal = false"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
         @click.self="showSourcesModal = false">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="bg-white dark:bg-brand-panel rounded-xl shadow-xl max-w-md w-full max-h-[80vh] overflow-y-auto">
            
            <div class="sticky top-0 bg-white dark:bg-brand-panel border-b border-gray-200 dark:border-gray-700 p-6 flex items-center justify-between">
                <h3 class="text-lg font-bold flex items-center gap-2">
                    <i class="fa-solid fa-book text-orange-600"></i>
                    <span>Источники конфига <span x-text="currentConfigId"></span></span>
                </h3>
                <button @click="showSourcesModal = false"
                        class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <div class="p-6 space-y-3">
                <template x-for="(source, index) in currentSources" :key="index">
                    <a :href="source"
                       target="_blank"
                       class="block p-3 bg-gray-50 dark:bg-black/30 hover:bg-gray-100 dark:hover:bg-black/50 rounded-lg border border-gray-200 dark:border-gray-700 transition">
                        <div class="flex items-center justify-between gap-2">
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-semibold text-brand-blue dark:text-blue-400 truncate" x-text="source"></p>
                            </div>
                            <i class="fa-solid fa-arrow-up-right-from-square flex-shrink-0 text-gray-400"></i>
                        </div>
                    </a>
                </template>
            </div>

            <div class="sticky bottom-0 bg-white dark:bg-brand-panel border-t border-gray-200 dark:border-gray-700 p-4">
                <button @click="showSourcesModal = false"
                        class="w-full py-2 rounded font-semibold bg-red-600 hover:bg-red-700 text-white transition">
                    Закрыть
                </button>
            </div>
        </div>
    </div>

    {% include 'components/footer.html' %}
</body>
</html>